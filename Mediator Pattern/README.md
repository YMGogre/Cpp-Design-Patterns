[ä¸Šä¸€ç¯‡](../Adapter%20Pattern/README.md)

---

# ä¸­ä»‹è€…æ¨¡å¼ Mediator

## 1ã€åŠ¨æœº

![ä¸­ä»‹è€…æ¨¡å¼](./images/1-Mediator.PNG)

* åœ¨è½¯ä»¶æ„å»ºè¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šå‡ºç°å¤šä¸ªå¯¹è±¡äº’ç›¸å…³è”äº¤äº’çš„æƒ…å†µï¼Œå¯¹è±¡ä¹‹é—´å¸¸å¸¸ä¼šç»´æŒä¸€ç§å¤æ‚çš„å¼•ç”¨å…³ç³»ï¼ˆå¦‚ä¸Šå›¾ A æ–¹æ¡ˆï¼‰ï¼Œå¦‚æœé‡åˆ°ä¸€äº›éœ€æ±‚çš„æ›´æ”¹ï¼Œè¿™ç§ç›´æ¥çš„å¼•ç”¨å…³ç³»å°†é¢ä¸´ä¸æ–­çš„å˜åŒ–ã€‚

    > æ¯”å¦‚ GUI æ¡†æ¶å‰ç«¯ç•Œé¢æ§ä»¶å…ƒç´ ä¸åç«¯æ•°æ®æ¨¡å‹å¯¹è±¡çš„äº’ç›¸å…³è”ã€‚å‰ç«¯ä¿®æ”¹ç•Œé¢å…ƒç´ æ—¶åç«¯æ¨¡å‹å¯¹è±¡æ›´æ–°ï¼›åŒç†åç«¯ä¿®æ”¹æ¨¡å‹å¯¹è±¡æ—¶å‰ç«¯ç•Œé¢æ˜¾ç¤ºæ›´æ–°ã€‚

* åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä½¿ç”¨ä¸€ä¸ª â€œä¸­ä»‹å¯¹è±¡â€ æ¥ç®¡ç†å¯¹è±¡é—´çš„å…³è”å…³ç³»ï¼ˆå¦‚ä¸Šå›¾ B æ–¹æ¡ˆï¼‰ï¼Œé¿å…ç›¸äº’äº¤äº’çš„å¯¹è±¡ä¹‹é—´çš„ç´§è€¦åˆå¼•ç”¨å…³ç³»ï¼Œä»è€Œæ›´å¥½åœ°æŠµå¾¡å˜åŒ–ã€‚

    > å¯ä»¥æ³¨æ„åˆ°ä¸­ä»‹è€…æ¨¡å¼å…¶å®æŒºç±»ä¼¼äº[å¤–è§‚æ¨¡å¼](../Facade%20Pattern/README.md)ï¼Œéƒ½æ˜¯æ·»åŠ ä¸€å±‚æ–°çš„ä¸­é—´å±‚æ¥éš”ç¦»ç´§è€¦åˆã€‚åŒºåˆ«åœ¨äºå¤–è§‚æ¨¡å¼ä¸»è¦è§£å†³å­ç³»ç»Ÿå†…éƒ¨ä¸å¤–éƒ¨çš„ç´§è€¦åˆï¼›è€Œä¸­ä»‹è€…ä¸»è¦è§£å†³ç³»ç»Ÿå†…å„ä¸ªå¯¹è±¡ä¹‹é—´çš„ç´§è€¦åˆã€‚

> ä¸­ä»‹è€…æ¨¡å¼æ˜¯ç”¨æ¥é™ä½å¤šä¸ªå¯¹è±¡å’Œç±»ä¹‹é—´çš„é€šä¿¡å¤æ‚æ€§ã€‚è¿™ç§æ¨¡å¼æä¾›äº†ä¸€ä¸ªä¸­ä»‹ç±»ï¼Œè¯¥ç±»é€šå¸¸å¤„ç†ä¸åŒç±»ä¹‹é—´çš„é€šä¿¡ï¼Œå¹¶æ”¯æŒæ¾è€¦åˆï¼Œä½¿ä»£ç æ˜“äºç»´æŠ¤ã€‚ä¸­ä»‹è€…æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚

## 2ã€ä»‹ç»

<dl>
    <dt>æ„å›¾</dt>
    <dd>ç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡æ¥å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ï¼Œä¸­ä»‹è€…ä½¿å„å¯¹è±¡ä¸éœ€è¦æ˜¾å¼åœ°ç›¸äº’å¼•ç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚</dd>
    <dt>å…³é”®ä»£ç </dt>
    <dd>å¯¹è±¡ Colleague ä¹‹é—´çš„é€šä¿¡å°è£…åˆ°ä¸€ä¸ªç±»ä¸­å•ç‹¬å¤„ç†ã€‚</dd>
</dl>

---

## 3ã€å®ç°

> ğŸ’¬ ä¸­ä»‹è€…æ¨¡å¼å¹¶æ²¡æœ‰ç‰¹å®šçš„ä»£ç ç»“æ„ï¼Œç”šè‡³ä¸¤æ®µç»“æ„çœ‹èµ·æ¥åƒå·®ä¸‡åˆ«çš„ä»£ç å¯èƒ½éƒ½è¡¨è¾¾çš„ä¸­ä»‹è€…æ¨¡å¼ã€‚åªè¦å®ƒä»¬éƒ½ä½“ç°äº†å°†ç³»ç»Ÿå†…éƒ¨å¤šä¸ªå¯¹è±¡è§£è€¦çš„æ€æƒ³ã€‚

æˆ‘ä»¬é€šè¿‡ä¸€ä¸ªèŠå¤©å®¤ç¤ºä¾‹æ¥æ¼”ç¤ºä¸­ä»‹è€…æ¨¡å¼ã€‚åœ¨ç¤ºä¾‹ä¸­ï¼Œå¤šä¸ªç”¨æˆ·å¯ä»¥å‘èŠå¤©å®¤å‘é€æ¶ˆæ¯ï¼ŒèŠå¤©å®¤å‘æ‰€æœ‰ç”¨æˆ·æ˜¾ç¤ºæ¶ˆæ¯ã€‚åœ¨æ­¤ç¤ºä¾‹ä¸­ï¼ŒèŠå¤©å®¤ ChatRoom å°†æ‰®æ¼”ä¸­ä»‹ç±»çš„è§’è‰²ã€‚

### æ­¥éª¤ä¸€

é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸­ä»‹ç±» ChatRoomã€‚å…¶åŒ…å«ä¸€ä¸ªæˆå‘˜å‡½æ•° `showMessage(User user, std::string message)` ç”¨äºæ˜¾ç¤ºæŒ‡å®šç”¨æˆ·å‘å‡ºçš„æ¶ˆæ¯ï¼›å…¶ä¸­ `user` å‚æ•°ä¼ é€’å‘å‡ºæ¶ˆæ¯çš„ç”¨æˆ·ï¼Œ`message` å‚æ•°ä¼ é€’ç”¨æˆ·å‘å‡ºçš„æ¶ˆæ¯ã€‚

æˆ‘ä»¬çš„ ChatRoom ç±»å¦‚ä¸‹ï¼š

```cpp
class ChatRoom
{

public:
	static inline void showMessage(User user, std::string message) {
		auto now = std::chrono::system_clock::now();
		std::time_t end_time = std::chrono::system_clock::to_time_t(now);
		char str[26];
		ctime_s(str, sizeof str, &end_time);
		std::string time_str(str);
		time_str.erase(std::remove(time_str.begin(), time_str.end(), '\n'), time_str.end());
		std::cout << time_str << " [" << user.getName() << "] : " << message << std::endl;
	}
};
```

> è¿™ä¸ªå‡½æ•°çœ‹èµ·æ¥ä¼¼ä¹è¿˜æŒºå¤æ‚ï¼Œä½†å…¶å®æœ€æ ¸å¿ƒçš„ä»£ç åªæœ‰å‡½æ•°å†…æœ€åä¸€è¡Œæ‰“å°è¾“å‡ºçš„ä»£ç ã€‚åœ¨æ­¤ä¹‹å‰çš„æ‰€æœ‰ä»£ç éƒ½æ˜¯åœ¨è·å–å½“å‰æ—¶é—´ï¼ˆ[å‚è€ƒé“¾æ¥](https://stackoverflow.com/questions/997946/how-to-get-current-time-and-date-in-c "How to get current time and date in C++? - Stack Overflow")ï¼‰ã€‚

### æ­¥éª¤äºŒ

æ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºç”¨æˆ·ç±» Userï¼Œå…¶å¯¹è±¡ä½¿ç”¨ ChatRoom æ¥åˆ†äº«ä»–ä»¬çš„æ¶ˆæ¯ï¼š

```cpp
class User
{

private:
	std::string name;

public:
	inline std::string getName() {
		return name;
	}
	inline void setName(std::string _name) {
		name = _name;
	}
	User(std::string _name) : name(_name) {}
	inline void sendMessage(std::string message) {
		ChatRoom::showMessage(*this, message);
	}
};
```

### æ­¥éª¤ä¸‰

åœ¨ `main()` å‡½æ•°ä¸­ï¼Œå¤šä¸ªç”¨æˆ·å°†äº’ç›¸èŠå¤©ï¼š

```cpp
int main() {
	User robert("Robert");
	User john("John");

	robert.sendMessage("Hi! John!");
	john.sendMessage("Hello! Robert!");
}
```

### æ­¥éª¤å››

æ‰§è¡Œç¨‹åºï¼Œè¾“å‡ºç»“æœï¼š

```plain
Thu Jan  4 09:14:57 2024 [Robert] : Hi! John!
Thu Jan  4 09:14:57 2024 [John] : Hello! Robert!
```

### æ­¥éª¤äº”

[æŸ¥çœ‹é¡¹ç›®ç±»å›¾](https://learn.microsoft.com/zh-cn/visualstudio/ide/class-designer/designing-and-viewing-classes-and-types?view=vs-2022#add-class-diagrams-to-projects)

---

## 4ã€æ€»ç»“

* å°†å¤šä¸ªå¯¹è±¡é—´å¤æ‚çš„å…³è”å…³ç³»è§£è€¦ï¼Œä¸­ä»‹è€…æ¨¡å¼å°†å¤šä¸ªå¯¹è±¡é—´çš„æ§åˆ¶é€»è¾‘è¿›è¡Œé›†ä¸­ç®¡ç†ï¼Œå˜ â€œå¤šä¸ªå¯¹è±¡äº’ç›¸å…³è”â€ ä¸º â€œå¤šä¸ªå¯¹è±¡å’Œä¸€ä¸ªä¸­ä»‹è€…å…³è”â€ã€‚ç®€åŒ–äº†ç³»ç»Ÿçš„ç»´æŠ¤ï¼ŒæŠµå¾¡äº†å¯èƒ½çš„å˜åŒ–ã€‚
* éšç€æ§åˆ¶é€»è¾‘çš„å¤æ‚åŒ–ï¼Œä¸­ä»‹è€…å…·ä½“å¯¹è±¡çš„å®ç°å¯èƒ½ç›¸å½“å¤æ‚ã€‚è¿™æ—¶å€™å¯ä»¥å¯¹ä¸­ä»‹è€…å¯¹è±¡è¿›è¡Œåˆ†è§£å¤„ç†ã€‚
* [å¤–è§‚æ¨¡å¼](../Facade%20Pattern/README.md)æ˜¯è§£è€¦ç³»ç»Ÿé—´ï¼ˆå•å‘ï¼‰çš„å¯¹è±¡å…³è”å…³ç³»ï¼›ä¸­ä»‹è€…æ¨¡å¼æ˜¯è§£è€¦ç³»ç»Ÿå†…å„ä¸ªå¯¹è±¡ä¹‹é—´ï¼ˆåŒå‘ï¼‰çš„å…³è”å…³ç³»ã€‚

---

[ä¸‹ä¸€ç¯‡](../State%20Pattern/README.md)